@model Application.DTOs.DeliveryRequestDTOs.DeliveryRequestDto

@{
    ViewData["Title"] = $"Sipariş Detayı #{Model.Id}";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Sipariş Detayı #@Model.Id</h2>

    <a asp-action="Index" class="btn btn-outline-secondary btn-sm">
        ← Siparişlerim
    </a>
</div>

<div class="card dark-card mb-4">
    <div class="card-header">
        <b>Sipariş Bilgileri</b>
    </div>
    <div class="card-body">

        <div class="row g-3">
            <div class="col-12 col-md-6">
                <div><b>Liste:</b> @Model.ListName</div>
                <div class="mt-1"><b>Teslimat Tarihi:</b> @Model.DeliveryDate.ToString("dd.MM.yyyy")</div>
                <div class="mt-1"><b>İstek Tarihi:</b> @Model.RequestedDate.ToString("dd.MM.yyyy HH:mm")</div>
            </div>

            <div class="col-12 col-md-6">
                <div>
                    <b>Durum:</b>
                    @switch (Model.Status)
                    {
                        case Domain.Enums.DeliveryStatus.Pending:
                            <span class="badge bg-secondary ms-2">Bekliyor</span>
                            break;
                        case Domain.Enums.DeliveryStatus.Prepared:
                            <span class="badge bg-warning text-dark ms-2">Hazırlandı</span>
                            break;
                        case Domain.Enums.DeliveryStatus.Shipped:
                            <span class="badge bg-info text-dark ms-2">Kuryede</span>
                            break;
                        case Domain.Enums.DeliveryStatus.Delivered:
                            <span class="badge bg-primary ms-2">Teslim Edildi</span>
                            break;
                        case Domain.Enums.DeliveryStatus.Completed:
                            <span class="badge bg-success ms-2">Tamamlandı</span>
                            break;
                        case Domain.Enums.DeliveryStatus.Cancelled:
                            <span class="badge bg-danger ms-2">İptal</span>
                            break;
                        default:
                            <span class="badge bg-dark ms-2">Bilinmiyor</span>
                            break;
                    }
                </div>
            </div>
        </div>

    </div>
</div>

<div class="card dark-card">
    <div class="card-header">
        <b>Filmler</b>
    </div>

    <div class="card-body p-0">
        @if (Model.Items == null || !Model.Items.Any())
        {
            <div class="p-3">
                <div class="alert alert-info mb-0">
                    Bu siparişte henüz film bulunmuyor. (Teslimat hazırlanma aşamasında olabilir.)
                </div>
            </div>
        }
        else
        {
            <table class="table dark-table mb-0 align-middle">
                <thead>
                    <tr>
                        <th style="width:80px;">#</th>
                        <th>Film</th>
                        <th style="width:140px;">İade</th>
                        <th style="width:140px;">Hasar</th>
                        <th style="width:180px;">İade Tarihi</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.Items.Count; i++)
                    {
                        var item = Model.Items[i];

                        <tr>
                            <td>@(i + 1)</td>
                            <td>@item.MovieTitle</td>
                            <td>
                                @if (item.IsReturned)
                                {
                                    <span class="badge bg-success">İade Edildi</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">İade Edilmedi</span>
                                }
                            </td>
                            <td>
                                @if (item.IsDamaged)
                                {
                                    <span class="badge bg-danger">Hasarlı</span>
                                }
                                else
                                {
                                    <span class="badge bg-success">Hasarsız</span>
                                }
                        </td>
                        <td>
                            @(item.ReturnDate.HasValue
                                                    ? item.ReturnDate.Value.ToString("dd.MM.yyyy HH:mm")
                                                    : "-")
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>
